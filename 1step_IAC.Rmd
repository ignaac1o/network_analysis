---
title: "1st_Step_IAC"
output: html_document
date: '2022-04-25'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(igraph)
library(igraphdata)
load("bicimad-data.RData")
```

## Identify relevant nodes and explain what information seems to be useful for understanding the network


In previous section we have already calculated the degree of each node. However, for this analysis it might be more useful to know which node is the one with highest degree, i.e that place were more bikes are taken and left. This node will mean one of the most concurred places for taking bicycles. 

This could represent that either other public transport methods are not accessible enough to get to that place of the city or that it is a place were most people visiting it are young and are willing to take a bike as a method to get there. We can easily obtain the index for the node with highest degree and its value, as well as the correspondent address:

```{r}
deg=degree(bicimad) %>% which.max()
degree(bicimad,deg)
vertex_attr(bicimad)$address[deg]
```

We can see that the node 169 is the one with highest degree (110). This corresponds to the station located in "Calle Manuel Silvela". Indeed, this street belongs to the neighborhood of "Trafalgar", which is a place frequently visited by young people, ergo people willing to take a bike as an option to get to that place easily and cheaply. Also, visualizing the area contained in the M-30 we can see that the point were this station is located is very close to what will be de geometric center of the figure.

Nevertheless, we have taken the degree without considering the weight. Therefore, that most frequent node correspond not to the most visited one but to the most diverse one i.e that one were more people from different stations over Madrid come and go.

Now to see which node is really the most visited one we have to consider the weights.

```{r}
wdeg=strength(bicimad) %>% which.max()
strength(bicimad,wdeg)
vertex_attr(bicimad)$address[wdeg]
```

We can now see that including the weights the most visited node is the number 132, visited 1653 times and corresponds to the address "Paseo de la Florida nº 8". This result makes also sense as that is a place were several points of interest are located, such us Pricipe Pio shopping center, the Manzanares river, the Real Palace and Plaza España, between many more.

We can finally check whether our network is a multigraph or not. Without further knowledge, the network might have loops, as leaving a bike on the same station where it has taken at first seems not only possible but very doable. Indeed we can see that it is a multigraph.

```{r}
is_simple(bicimad)
```

## Is the graph connected? Obtain components, diameter, farther vertices,...

Now, to know if every vertex is reachable from every other i.e. being connected, we can take this function.

```{r}
is_connected(bicimad)
```

As expected, the graph is indeed connected. This is reasonable as there are not constraints about going to one place or another using these type of bike service. You can take a bike from any station and return it whatever different one.

```{r}
components(bicimad)
```

Indeed the components as expected is the whole graph that we have been discussing above.

Now, to know, which is the longest path between vertices, we can obtain its diameter. We could either do it considering the weights or not. However, as the weights in our network represents the number of times each link is repeated, we believe that it does not make any sense to compute the diameter considering the weights. Therefore we calculate them without the weights.

```{r}
get_diameter(bicimad,weights=rep(1,gsize(bicimad)))
diameter(bicimad,weights=rep(1,gsize(bicimad)))
```

We can see that the longest ride possible for the network  without considering weights is going from "Puerta del Sol" to "Avenida de la Complutense n23" but passing through "Calle Desengaño n1" and "Avenida de Camilo José Cela n23" respectively. Also we can compute the farthest node, which will be the start and end point of the diameter before calculated.

```{r}
farthest_vertices(bicimad,weights=rep(1,gsize(bicimad)))
```

Checking this journey in Google maps, it says that there is a 5.5km distance between those two and it might take about 25 minutes to get there.

We can see that without further knowledge considering this trip as the longest one does not make much sense. Therefore we are going to consider weight for the network, but not the ones already associated with each link. We will use another attribute for the weights. We have computed the mean travel time for each link and this will indicate for each link on the network the mean journey time for going from one vertices to another.

```{r}
farthest_vertices(bicimad,weights=trip_summarize$mean_travel_time[indexes])
```


Now this result makes much sense as this nodes corresponds to "Calle de Pedro Rico n4" and "Calle de la Hacienda de pavones n342". Checking the distance in Google Maps we can see that the fastest path is 13.3 km long and might take over 47 minutes.








